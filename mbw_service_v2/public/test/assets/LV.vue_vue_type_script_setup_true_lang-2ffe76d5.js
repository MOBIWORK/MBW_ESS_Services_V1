import{q as L,aO as se,x as j,bi as re,A as $,bR as E,a_ as _e,az as C,aC as I,s as ie,a6 as xe,a9 as ee,aR as ke,bj as we,aS as $e,aN as ue,a$ as Re,F as B,aP as Se,ab as R,aX as P,aB as J,aV as te,aW as D,aZ as ae,_ as Ce,h as N,o as u,c as S,w as T,a as k,b,d as F,f as O,j as A,l as de,t as G,a1 as Z,bU as ce,J as Ve,C as Le,a7 as Ee,B as X,M as Oe,y as s,p as V,af as Be,r as z,H as Te,bV as Fe,bW as Ge,bX as Pe,ar as Ae,n as oe,g as ne,b1 as Ne}from"./index-aea319af.js";import{s as w,b as je,p as Ke}from"./notification-c4068361.js";import{_ as De}from"./EmptyMessage.vue_vue_type_script_setup_true_lang-fbb9efd4.js";import{K as pe,T as Ie}from"./label-bdf4c41a.js";import{p as ze}from"./use-tree-walker-388abf0b.js";import{d as qe,e as He,p as Ue}from"./use-controllable-f6b0426f.js";function Me(e,l){return e===l}let me=Symbol("RadioGroupContext");function fe(e){let l=R(me,null);if(l===null){let d=new Error(`<${e} /> is missing a parent <RadioGroup /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(d,fe),d}return l}let We=L({name:"RadioGroup",emits:{"update:modelValue":e=>!0},props:{as:{type:[Object,String],default:"div"},disabled:{type:[Boolean],default:!1},by:{type:[String,Function],default:()=>Me},modelValue:{type:[Object,String,Number,Boolean],default:void 0},defaultValue:{type:[Object,String,Number,Boolean],default:void 0},form:{type:String,optional:!0},name:{type:String,optional:!0},id:{type:String,default:()=>`headlessui-radiogroup-${se()}`}},inheritAttrs:!1,setup(e,{emit:l,attrs:d,slots:y,expose:n}){let i=j(null),r=j([]),v=pe({name:"RadioGroupLabel"}),h=re({name:"RadioGroupDescription"});n({el:i,$el:i});let[c,f]=qe($(()=>e.modelValue),t=>l("update:modelValue",t),$(()=>e.defaultValue)),o={options:r,value:c,disabled:$(()=>e.disabled),firstOption:$(()=>r.value.find(t=>!t.propsRef.disabled)),containsCheckedOption:$(()=>r.value.some(t=>o.compare(E(t.propsRef.value),E(e.modelValue)))),compare(t,p){if(typeof e.by=="string"){let m=e.by;return t?.[m]===p?.[m]}return e.by(t,p)},change(t){var p;if(e.disabled||o.compare(E(c.value),E(t)))return!1;let m=(p=r.value.find(_=>o.compare(E(_.propsRef.value),E(t))))==null?void 0:p.propsRef;return m!=null&&m.disabled?!1:(f(t),!0)},registerOption(t){r.value.push(t),r.value=_e(r.value,p=>p.element)},unregisterOption(t){let p=r.value.findIndex(m=>m.id===t);p!==-1&&r.value.splice(p,1)}};C(me,o),ze({container:$(()=>I(i)),accept(t){return t.getAttribute("role")==="radio"?NodeFilter.FILTER_REJECT:t.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(t){t.setAttribute("role","none")}});function a(t){if(!i.value||!i.value.contains(t.target))return;let p=r.value.filter(m=>m.propsRef.disabled===!1).map(m=>m.element);switch(t.key){case P.Enter:Ue(t.currentTarget);break;case P.ArrowLeft:case P.ArrowUp:if(t.preventDefault(),t.stopPropagation(),te(p,D.Previous|D.WrapAround)===ae.Success){let m=r.value.find(_=>{var x;return _.element===((x=J(i))==null?void 0:x.activeElement)});m&&o.change(m.propsRef.value)}break;case P.ArrowRight:case P.ArrowDown:if(t.preventDefault(),t.stopPropagation(),te(p,D.Next|D.WrapAround)===ae.Success){let m=r.value.find(_=>{var x;return _.element===((x=J(_.element))==null?void 0:x.activeElement)});m&&o.change(m.propsRef.value)}break;case P.Space:{t.preventDefault(),t.stopPropagation();let m=r.value.find(_=>{var x;return _.element===((x=J(_.element))==null?void 0:x.activeElement)});m&&o.change(m.propsRef.value)}break}}let g=$(()=>{var t;return(t=I(i))==null?void 0:t.closest("form")});return ie(()=>{xe([g],()=>{if(!g.value||e.defaultValue===void 0)return;function t(){o.change(e.defaultValue)}return g.value.addEventListener("reset",t),()=>{var p;(p=g.value)==null||p.removeEventListener("reset",t)}},{immediate:!0})}),()=>{let{disabled:t,name:p,id:m,form:_,...x}=e,K={ref:i,id:m,role:"radiogroup","aria-labelledby":v.value,"aria-describedby":h.value,onKeydown:a};return ee(B,[...p!=null&&c.value!=null?He({[p]:c.value}).map(([M,W])=>ee(ke,we({features:$e.Hidden,key:M,as:"input",type:"hidden",hidden:!0,readOnly:!0,form:_,name:M,value:W}))):[],ue({ourProps:K,theirProps:{...d,...Re(x,["modelValue","defaultValue","by"])},slot:{},attrs:d,slots:y,name:"RadioGroup"})])}}});var Je=(e=>(e[e.Empty=1]="Empty",e[e.Active=2]="Active",e))(Je||{});let Xe=L({name:"RadioGroupOption",props:{as:{type:[Object,String],default:"div"},value:{type:[Object,String,Number,Boolean]},disabled:{type:Boolean,default:!1},id:{type:String,default:()=>`headlessui-radiogroup-option-${se()}`}},setup(e,{attrs:l,slots:d,expose:y}){let n=fe("RadioGroupOption"),i=pe({name:"RadioGroupLabel"}),r=re({name:"RadioGroupDescription"}),v=j(null),h=$(()=>({value:e.value,disabled:e.disabled})),c=j(1);y({el:v,$el:v});let f=$(()=>I(v));ie(()=>n.registerOption({id:e.id,element:f,propsRef:h})),Se(()=>n.unregisterOption(e.id));let o=$(()=>{var x;return((x=n.firstOption.value)==null?void 0:x.id)===e.id}),a=$(()=>n.disabled.value||e.disabled),g=$(()=>n.compare(E(n.value.value),E(e.value))),t=$(()=>a.value?-1:g.value||!n.containsCheckedOption.value&&o.value?0:-1);function p(){var x;n.change(e.value)&&(c.value|=2,(x=I(v))==null||x.focus())}function m(){c.value|=2}function _(){c.value&=-3}return()=>{let{id:x,value:K,disabled:M,...W}=e,be={checked:g.value,disabled:a.value,active:Boolean(c.value&2)},he={id:x,ref:v,role:"radio","aria-checked":g.value?"true":"false","aria-labelledby":i.value,"aria-describedby":r.value,"aria-disabled":a.value?!0:void 0,tabIndex:t.value,onClick:a.value?void 0:p,onFocus:a.value?void 0:m,onBlur:a.value?void 0:_};return ue({ourProps:he,theirProps:W,slot:be,attrs:l,slots:d,name:"RadioGroupOption"})}}}),Ze=Ie;const Qe={name:"TabButtons",props:{buttons:{type:Array,required:!0},modelValue:{type:[String,Boolean,Number]}},emits:["update:modelValue"],components:{RadioGroup:We,RadioGroupOption:Xe,RadioGroupLabel:Ze},computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}}},Ye={class:"flex space-x-1 rounded bg-gray-100 p-0.5 text-sm"};function et(e,l,d,y,n,i){const r=N("RadioGroupLabel"),v=N("RadioGroupOption"),h=N("RadioGroup");return u(),S(h,{modelValue:i.value,"onUpdate:modelValue":l[0]||(l[0]=c=>i.value=c)},{default:T(()=>[k("div",Ye,[(u(!0),b(B,null,F(d.buttons,c=>(u(),S(v,{as:"template",key:c.label,value:c.value??c.label},{default:T(({active:f,checked:o})=>[k("button",{class:O([f?"ring-gray-300 focus-visible:ring":"",o?"bg-white text-gray-900 shadow":"text-gray-700","rounded-[7px] px-2 py-1.5 leading-none transition-colors focus:outline-none"])},[A(r,{as:"span"},{default:T(()=>[de(G(c.label),1)]),_:2},1024)],2)]),_:2},1032,["value"]))),128))])]),_:1},8,["modelValue"])}const tt=Ce(Qe,[["render",et]]);function Q(e){const y=["hide_columns",Z().path,e].join("_"),n=ce(y,new Set);function i(r){n.value.delete(r)||n.value.add(r)}return{storage:n,toggle:i}}const at="filters_",le={is:"=","is not":"!=",equals:"=","not equals":"!=",yes:!0,no:!1,like:"LIKE","not like":"NOT LIKE",">":">","<":"<",">=":">=","<=":"<="};function ot(e){const l=Z(),d=Oe(),{userId:y}=Ve(),n=ce(at+l.name.toString(),new Set),i=Le({url:"helpdesk.api.doc.get_filterable_fields",cache:["DocField",e],auto:!!e,params:{doctype:e,append_assign:!0},transform:a=>(a=X.orderBy(a.map(g=>({label:g.label,value:g.fieldname,...g})),"label"),a)});Ee(()=>{if(!i.data)return;const a=l.query.q;a&&(n.value=new Set(r(a,i.data)))});function r(a,g){return a.split(" ").map(t=>{const[p,m,_]=t.split(":").map(decodeURIComponent);return{field:(g||[]).find(K=>K.fieldname===p),fieldname:p,operator:m,value:_}}).filter(t=>!g||g&&t.field).filter(t=>le[t.operator])}function v(a){a=a||{};const t=Array.from(n.value).map(f).reduce((m,_)=>(m[_.fieldname]=[le[_.operator.toLowerCase()],_.value],m),{});return{...a,...t}}function h(a){n.value.forEach(g=>{g.fieldname===a.fieldname&&n.value.delete(g)}),n.value.add(a)}function c(a){a=a||l;const t=Array.from(n.value).map(o).map(p=>[p.fieldname,p.operator.toLowerCase(),p.value].map(encodeURIComponent).join(":")).join(" ");d.push({...a,query:{...a.query,q:t}})}function f(a){return a.fieldname==="_assign"&&(a.operator=a.operator==="is"?"like":"not like"),a.operator.includes("like")&&(a.value=`%${a.value}%`),a}function o(a){return a.value==="@me"&&(a.value=y),a}return{add:h,apply:c,fields:i.data,getArgs:v,storage:n}}const q=Symbol("Checkbox"),H=Symbol("Columns"),Y=Symbol("DocType"),nt=Symbol("Filter"),ve=Symbol("Id"),ge=Symbol("Plural"),U=Symbol("Resource"),ye=Symbol("Singular"),lt={class:"flex h-full w-full items-center justify-center text-base text-gray-700"},st=L({__name:"LVEmpty",props:{message:null},setup(e){return(l,d)=>(u(),b("div",lt,[A(De,{message:e.message},null,8,["message"])]))}}),rt={class:"mx-5 rounded bg-gray-100 px-2.5 py-2 text-sm text-gray-600"},it={class:"flex w-full items-center gap-2"},ut=L({__name:"LVHeader",setup(e){const l=R(q),d=R(H),y=R(Y),n=R(U),{storage:i}=Q(y);function r(){if(w.storage.size===n.data.length){w.storage.clear();return}n.data.forEach(v=>w.storage.add(v.name))}return(v,h)=>{const c=N("FormControl");return u(),b("div",rt,[k("div",it,[s(l)?(u(),S(c,{key:0,type:"checkbox","model-value":s(n).data?.length===s(w).storage.size,"onUpdate:modelValue":h[0]||(h[0]=f=>r())},null,8,["model-value"])):V("",!0),(u(!0),b(B,null,F(s(d),f=>(u(),b("div",{key:f.key},[s(i).has(f.key)?V("",!0):(u(),b("div",{key:0,class:O([f.width])},[k("span",{class:O([f.align])},G(f.label),3)],2))]))),128))])])}}}),dt={class:"animate-pulse divide-y overflow-y-auto px-2.5"},ct={key:0,class:"h-3.5 w-3.5 rounded-sm bg-gray-200"},pt=k("div",{class:"h-4 rounded-sm bg-gray-200"},null,-1),mt=[pt],ft=L({__name:"LVLoading",setup(e){const l=R(q),d=R(H),y=R(ve),{storage:n}=Q(y);return(i,r)=>(u(),b("div",dt,[(u(),b(B,null,F(20,v=>k("div",{key:v,class:"flex h-10 w-full items-center space-x-2 px-5"},[s(l)?(u(),b("div",ct)):V("",!0),(u(!0),b(B,null,F(s(d),h=>(u(),b("div",{key:h.key,class:"flex items-center space-x-2"},[s(n).has(h.key)?V("",!0):(u(),b("div",{key:0,class:O([h.width])},mt,2))]))),128))])),64))]))}}),vt={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},gt=k("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"},null,-1),yt=[gt];function bt(e,l){return u(),b("svg",vt,yt)}const ht={name:"lucide-loader2",render:bt},_t={class:"flex items-center justify-between border-t px-5 py-2"},xt={class:"flex items-center"},kt={key:1,class:"space-x-1 text-base"},wt={class:"text-gray-900"},$t=k("span",{class:"text-gray-700"},"of",-1),Rt={class:"text-gray-900"},St=L({__name:"LVNavigation",setup(e){const l=[20,50,500],d=R(U);return(y,n)=>{const i=ht;return u(),b("div",_t,[A(s(tt),{buttons:s(l).map(r=>({label:r})),"model-value":s(d).pageLength,"onUpdate:modelValue":n[0]||(n[0]=r=>{s(d).update({pageLength:r}),s(d).reload()})},null,8,["buttons","model-value"]),k("span",xt,[s(d).list.loading?(u(),S(i,{key:0,class:"mr-2 inline h-4 w-4 animate-spin"})):V("",!0),s(d).data?.length?(u(),b("span",kt,[k("span",wt,G(s(d).data?.length),1),$t,k("span",Rt,G(s(d).totalCount),1)])):V("",!0)])])}}}),Ct=["onClick"],Vt=L({__name:"LVRow",props:{data:null},setup(e){const l=e,d=R(q),y=R(H),n=R(Y),{storage:i}=Q(n),r=je(),v=ot(n);async function h(c,f){n&&(await r.fetch(n),r.get(n).filter(o=>["Link","Select"].includes(o.fieldtype)).filter(o=>o.fieldname===f.key).map(o=>{let a=l.data[f.key];return o.fieldname==="_assign"&&(a=Ge(a)),{fieldname:o.fieldname,label:o.label,operator:"is",value:a}}).filter(o=>o.value).forEach(o=>{c.preventDefault(),c.stopPropagation(),v.add(o),v.apply()}))}return(c,f)=>(u(),b("div",{class:O(["group mx-5 flex h-10 items-center gap-2 whitespace-nowrap px-2.5 text-base",{"bg-blue-100":s(w).storage.has(e.data.name),"hover:bg-blue-200":s(w).storage.has(e.data.name),"hover:bg-gray-100":!s(w).storage.has(e.data.name),"cursor-pointer":!!e.data.onClick,...e.data.class}])},[s(d)?(u(),S(s(Be),{key:0,type:"checkbox","model-value":s(w).storage.has(e.data.name),"onUpdate:modelValue":f[0]||(f[0]=o=>s(w).toggle(e.data.name))},null,8,["model-value"])):V("",!0),(u(),S(Te(s(X.isFunction)(e.data.onClick)?"span":s(Fe)),{as:"template",to:e.data.onClick,class:"flex w-full items-center gap-2",onClick:f[1]||(f[1]=o=>{s(X.isFunction)(e.data.onClick)&&(o.preventDefault(),e.data.onClick())})},{default:T(()=>[(u(!0),b(B,null,F(s(y),o=>(u(),b("div",{key:o.key,class:O({"text-gray-800":e.data[o.key],"text-gray-300":!e.data[o.key]})},[s(i).has(o.key)?V("",!0):(u(),b("div",{key:0,class:O([o.width])},[k("div",{class:O(["w-max max-w-full truncate",[o.align,o.text]]),onClick:a=>h(a,o)},[z(c.$slots,o.key,{data:e.data},()=>[de(G(e.data[o.key]||"â¸º"),1)])],10,Ct)],2))],2))),128))]),_:3},8,["to"]))],2))}}),Lt={key:0,class:"fixed inset-x-0 bottom-6 mx-auto flex w-max items-center gap-1 rounded bg-white p-1 text-base shadow"},Et={class:"inline-block w-64 pl-2 align-middle text-gray-900"},Ot={class:"space-x-2"},Bt=k("div",{class:"text-gray-300"},"|",-1),Tt=L({__name:"LVSelectionBar",setup(e){const l=R(U),d=R(ye),y=R(ge);function n(){if(w.storage.size===l.data?.length){w.storage.clear();return}l.data.forEach(i=>w.storage.add(i.name))}return(i,r)=>{const v=N("Button");return u(),S(Pe,{"enter-active-class":"duration-300 ease-out","enter-from-class":"transform opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"transform opacity-0"},{default:T(()=>[s(w).storage.size?(u(),b("div",Lt,[k("div",Et,G(s(w).storage.size)+" "+G(s(w).storage.size<2?s(d):s(y))+" selected ",1),k("span",Ot,[z(i.$slots,"actions",{selection:s(w).storage})]),Bt,A(v,{disabled:s(l).data?.length===s(w).storage.size,label:"Select all",variant:"ghost",onClick:r[0]||(r[0]=h=>n())},null,8,["disabled"])])):V("",!0)]),_:3})}}}),Ft={class:"mt-2 flex w-full grow flex-col overflow-hidden overflow-x-auto"},Gt={class:"flex h-full w-max min-w-full flex-col overflow-y-hidden text-gray-900"},It=L({__name:"LV",props:{columns:null,doctype:null,resource:null,checkbox:{type:Boolean,default:!1},filter:{type:Boolean,default:!1}},setup(e){const l=e,d=Z(),y=j(null),n=$(()=>l.doctype.replace("HD ","").toLowerCase().trim()),i=$(()=>Ke.plural(n.value)),r=$(()=>`No ${i.value} found`),v=$(()=>d.path+"_"+l.doctype),h=Ne(()=>{if(!l.resource.hasNextPage)return;const c=y.value.scrollHeight,f=y.value.scrollTop,o=y.value.clientHeight;f/(c-o)*100>=90&&l.resource.next()},500);return C(q,l.checkbox),C(H,l.columns),C(Y,l.doctype),C(nt,l.filter),C(ve,v.value),C(ge,i),C(U,l.resource),C(ye,n),(c,f)=>(u(),b(B,null,[k("div",Ft,[k("div",Gt,[e.resource.data?.length?(u(),S(ut,{key:1})):(u(),S(st,{key:0,message:s(r)},null,8,["message"])),k("div",{ref_key:"body",ref:y,class:"grow divide-y overflow-y-auto",onScroll:f[0]||(f[0]=()=>s(h)())},[e.resource.loading?(u(),S(ft,{key:0})):(u(!0),b(B,{key:1},F(e.resource.data,o=>(u(),S(Vt,{id:s(v),key:o.name,checkbox:e.checkbox,columns:e.columns,data:o,doctype:e.doctype,filter:e.filter,to:o.onClick},Ae({_:2},[F(c.$slots,(a,g)=>({name:g,fn:T(t=>[z(c.$slots,g,oe(ne(t)))])}))]),1032,["id","checkbox","columns","data","doctype","filter","to"]))),128))],544)]),A(Tt,{data:e.resource.data||[]},{actions:T(o=>[z(c.$slots,"actions",oe(ne(o)))]),_:3},8,["data"])]),A(St,{resource:e.resource},null,8,["resource"])],64))}});export{tt as T,It as _,Q as a,ot as u};
