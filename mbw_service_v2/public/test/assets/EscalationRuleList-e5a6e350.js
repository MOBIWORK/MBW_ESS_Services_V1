import{_ as V}from"./plus-d3fdba1e.js";import{q as x,aj as $,o as u,b as _,a as v,t as D,F as S,d as A,j as i,y as n,p as T,ak as N,al as g,C as B,A as f,c as H,w as y,ao as C,D as P,x as E,ad as q,aA as w,ai as L,l as j,h as F}from"./index-aea319af.js";import{c as U}from"./notification-c4068361.js";import{_ as M}from"./LV.vue_vue_type_script_setup_true_lang-2ffe76d5.js";import{_ as O}from"./PageTitle.vue_vue_type_script_setup_true_lang-98ef5881.js";import"./iconify-d47d89f2.js";import{u as h}from"./error-bdedfa48.js";import{_ as z}from"./SearchComplete.vue_vue_type_script_setup_true_lang-9dff0c56.js";import"./EmptyMessage.vue_vue_type_script_setup_true_lang-fbb9efd4.js";import"./label-bdf4c41a.js";import"./use-tree-walker-388abf0b.js";import"./use-controllable-f6b0426f.js";import"./combobox-3f3680f7.js";import"./use-tracked-pointer-f136af1c.js";const G={class:"space-y-2"},I={class:"text-lg font-medium text-gray-900"},J={class:"flex flex-wrap items-center gap-2 text-base"},K={class:"text-gray-800"},Q={key:0,class:"text-gray-600"},R=x({__name:"EscalationRuleDialogFieldList",props:{title:{type:String,required:!0},items:{type:Array,required:!0},doc:{type:Object,required:!0}},emits:["update:doc"],setup(r,{emit:c}){const d=$(r,"doc");function e(l,s){c("update:doc",{...d.value,[l]:s})}return(l,s)=>(u(),_("div",G,[v("div",I,D(r.title),1),v("div",J,[(u(!0),_(S,null,A(r.items,(t,p)=>(u(),_("div",{key:t.key,class:"flex items-center gap-2"},[v("div",K,D(t.label),1),i(z,{placeholder:"Any",doctype:t.doctype,value:n(d)[t.key],onChange:m=>e(t.key,m.value)},null,8,["doctype","value","onChange"]),p+1<r.items.length?(u(),_("span",Q," and ")):T("",!0)]))),128))])]))}}),W={class:"space-y-4"},X=x({__name:"EscalationRuleDialog",props:{name:{type:String,required:!0}},setup(r){const o=N({doctype:"HD Escalation Rule",name:r.name||747,fields:["name","priority","team","to_team","to_agent","to_priority"],auto:!0,onError(){o.doc={}},setValue:{debounce:3e3,onSuccess(){g({title:"Rule updated",icon:"check",iconClasses:"text-green-500"})},onError:h({title:"Error updating rule"})},delete:{onSuccess(){g({title:"Rule deleted",icon:"check",iconClasses:"text-green-500"})},onError:h({title:"Error deleting rule"})}}),d=B({url:"frappe.client.insert",onSuccess(a){g({title:"Rule created",icon:"check",iconClasses:"text-green-500"}),o.name=a.name,o.reload()},onError:h({title:"Error creating rule"})}),e=f({get(){return o.doc||{}},set(a){o.doc=a}}),l=f(()=>!e.value.name);function s(){const a={is_enabled:e.value.is_enabled,priority:e.value.priority,team:e.value.team,ticket_type:e.value.ticket_type,to_agent:e.value.to_agent,to_priority:e.value.to_priority,to_team:e.value.to_team,to_ticket_type:e.value.to_ticket_type};if(e.value.name){o.setValue.submit(a);return}d.submit({doc:{doctype:"HD Escalation Rule",...a}})}const t=f(()=>({title:l.value?"New rule":"Edit rule",actions:[{label:l.value?"Create":"Save",theme:"gray",variant:"subtle",onClick:()=>s()},{label:e.value?.is_enabled?"Disable":"Enable",theme:e.value?.is_enabled?"red":"green",variant:"subtle",onClick:()=>o.setValue.submit({is_enabled:!e.value.is_enabled}),hidden:l.value},{label:"Delete",theme:"red",variant:"subtle",onClick:()=>o.delete.submit(),hidden:l.value}].filter(a=>!a.hidden)})),p=[{label:"Priority is",doctype:"HD Ticket Priority",key:"priority"},{label:"Team is",doctype:"HD Team",key:"team"},{label:"Ticket type is",doctype:"HD Ticket Type",key:"ticket_type"}],m=[{label:"Change priority to",doctype:"HD Ticket Priority",key:"to_priority"},{label:"Change team to",doctype:"HD Team",key:"to_team"},{label:"Change ticket type to",doctype:"HD Ticket Type",key:"to_ticket_type"},{label:"Assign to",doctype:"HD Agent",key:"to_agent"}];return(a,k)=>(u(),H(n(P),{options:n(t)},{"body-content":y(()=>[v("div",W,[i(R,{doc:n(e),"onUpdate:doc":k[0]||(k[0]=b=>C(e)?e.value=b:null),title:"Criteria",items:p},null,8,["doc"]),i(R,{doc:n(e),"onUpdate:doc":k[1]||(k[1]=b=>C(e)?e.value=b:null),title:"Actions",items:m},null,8,["doc"])])]),_:1},8,["options"]))}}),Y={class:"flex flex-col"},me=x({__name:"EscalationRuleList",setup(r){const c=E(!1),o=E(null),d=[{label:"Priority",key:"priority",width:"w-64"},{label:"Team",key:"team",width:"w-64"},{label:"Ticket type",key:"ticket_type",width:"w-64"},{label:"Status",key:"is_enabled",width:"w-20"}],e=U({doctype:"HD Escalation Rule",fields:["name","priority","team","ticket_type","is_enabled"],auto:!0,transform:s=>{for(const t of s)t.onClick=()=>l(t.name);return s}});q(()=>({title:"Escalation rules"}));function l(s){o.value=s,c.value=!0}return w.on("helpdesk:new-escalation-rule",()=>e.reload()),w.on("helpdesk:delete-escalation-rule",()=>e.reload()),(s,t)=>{const p=V,m=F("Button");return u(),_("div",Y,[i(O,{title:"Escalation Rules"},{right:y(()=>[i(m,{label:"New rule",theme:"gray",variant:"solid",onClick:t[0]||(t[0]=a=>l(null))},{prefix:y(()=>[i(p,{class:"h-4 w-4"})]),_:1})]),_:1}),i(n(M),{columns:d,resource:n(e),class:"mt-2.5",doctype:"HD Escalation Rule"},{is_enabled:y(({data:a})=>[i(n(L),{theme:a.is_enabled?"green":"red",variant:"subtle"},{default:y(()=>[j(D(a.is_enabled?"Enabled":"Disabled"),1)]),_:2},1032,["theme"])]),_:1},8,["resource"]),c.value?(u(),H(X,{key:0,modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=a=>c.value=a),name:o.value},null,8,["modelValue","name"])):T("",!0)])}}});export{me as default};
