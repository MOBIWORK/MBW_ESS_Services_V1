import{_ as k}from"./plus-d3fdba1e.js";import{_ as C,D as E,I as Q,aq as A,x as I,o as d,b as h,j as a,ar as S,w as i,l as f,a as r,c as y,p as w,E as T,F as V,d as $,t as b,h as _,q as D,ad as F,Q as B,y as g,ai as N}from"./index-aea319af.js";import{_ as R}from"./Avatar.vue_vue_type_script_setup_true_lang-827ced2f.js";import{c as L}from"./notification-c4068361.js";import{u as P,_ as H}from"./LV.vue_vue_type_script_setup_true_lang-2ffe76d5.js";import{_ as M}from"./PageTitle.vue_vue_type_script_setup_true_lang-98ef5881.js";import"./iconify-d47d89f2.js";import"./error-bdedfa48.js";import"./EmptyMessage.vue_vue_type_script_setup_true_lang-fbb9efd4.js";import"./label-bdf4c41a.js";import"./use-tree-walker-388abf0b.js";import"./use-controllable-f6b0426f.js";const j={name:"AddNewAgentsDialog",props:["show"],components:{Dialog:E,Input:Q,FeatherIcon:A},setup(){const t=I(""),e=I([]),u=I(!1);return{searchInput:t,inviteQueue:e,currentInputIsValidEmail:u}},methods:{testEmailRegex(t){return/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(t)},onSearchInputChange(t){if(t=t.replaceAll(" ",""),t==""){document.getElementById("searchInput").value="";return}const e=t,u=t.split(",");let s=!1;this.currentInputIsValidEmail=!1,u.forEach(p=>{this.testEmailRegex(p)&&(u.length>1?(this.addToInviteQueue(p),s=!0):e.includes(",")?(this.addToInviteQueue(p),s=!0):this.currentInputIsValidEmail=!0)}),s&&this.clearSearchInput()},addToInviteQueue(t){this.inviteQueue=[...new Set([...this.inviteQueue,t])]},removeEmailFromQueue(t){this.inviteQueue=this.inviteQueue.filter(e=>e!==t)},removeAllEmailFromQueue(){this.inviteQueue=[]},clearSearchInput(){this.currentInputIsValidEmail=!1,this.searchInput="";const t=document.getElementById("searchInput");t.value="",t.focus()},close(){this.searchInput="",this.inviteQueue=[],this.$emit("close")},sentInvites(){this.$resources.sentInvites.submit({emails:this.inviteQueue})}},resources:{sentInvites(){return{url:"helpdesk.api.agent.sent_invites",onSuccess:t=>{this.currentInputIsValidEmail=!1,this.searchInput="",this.inviteQueue=[],this.$toast({title:"Invites Sent Successfully!",icon:"check",iconClasses:"text-green-500"}),this.close()},onError:t=>{t.exc_type=="PaywallReachedError"?this.$toast({title:"Paywall Reached!",text:"You have reached the maximum number of agents you can add. Please upgrade your plan to add more agents.",icon:"x",iconClasses:"text-red-500"}):this.$toast({title:"Error Sending Invites!",icon:"x",iconClasses:"text-red-500"})}}}}},q={class:"space-y-3"},z={key:0,class:"bg-gray-100 min-h-[100px] max-h-[300px] overflow-y-auto px-2 rounded border flex flex-col"},U={class:"flex flex-wrap gap-2 py-2"},G=["title"],K={class:"text-base ml-2"},O=["onClick"],Y={class:"grow"};function J(t,e,u,s,p,o){const v=_("Input"),l=_("Button"),c=_("FeatherIcon"),x=_("Dialog");return d(),h("div",null,[a(x,{options:{title:"Add Agents"},show:u.show,onClose:e[7]||(e[7]=n=>o.close())},S({"body-content":i(()=>[r("div",q,[r("form",{onSubmit:e[3]||(e[3]=T((...n)=>t.onSubmit&&t.onSubmit(...n),["prevent"])),class:"flex flex-row space-x-2 items-center"},[a(v,{id:"searchInput",class:"w-full",type:"text",modelValue:s.searchInput,"onUpdate:modelValue":e[0]||(e[0]=n=>s.searchInput=n),placeholder:"Type emails",onInput:e[1]||(e[1]=n=>o.onSearchInputChange(n))},null,8,["modelValue"]),a(l,{appearance:"primary",type:"submit",disabled:!s.currentInputIsValidEmail,onClick:e[2]||(e[2]=()=>{o.addToInviteQueue(s.searchInput),o.clearSearchInput()})},{default:i(()=>[f(" Add ")]),_:1},8,["disabled"])],32),s.inviteQueue.length?(d(),h("div",z,[r("ul",U,[(d(!0),h(V,null,$(s.inviteQueue.slice().reverse(),n=>(d(),h("li",{class:"flex items-center p-1 space-x-2 bg-white shadow rounded",key:n,title:n},[r("span",K,b(n),1),r("button",{class:"grid w-4 h-4 text-gray-700 rounded hover:bg-gray-300 place-items-center",onClick:m=>o.removeEmailFromQueue(n)},[a(c,{class:"w-3",name:"x"})],8,O)],8,G))),128))])])):w("",!0)])]),_:2},[s.inviteQueue.length?{name:"actions",fn:i(()=>[a(l,{disabled:s.inviteQueue.length==0,appearance:"primary",onClick:e[4]||(e[4]=n=>o.sentInvites()),class:"mr-2",loading:t.$resources.sentInvites.loading},{default:i(()=>[f("Send Invites")]),_:1},8,["disabled","loading"]),a(l,{appearance:"secondary",class:"mr-2",onClick:e[5]||(e[5]=n=>o.close())},{default:i(()=>[f("Cancel")]),_:1}),r("div",Y,[s.inviteQueue.length>1?(d(),y(l,{key:0,onClick:e[6]||(e[6]=n=>o.removeAllEmailFromQueue())},{default:i(()=>[f(" Clear All ")]),_:1})):w("",!0)])]),key:"0"}:void 0]),1032,["show"])])}const W=C(j,[["render",J]]),X={class:"flex flex-col"},Z={class:"flex items-center justify-between"},ee={class:"flex items-center gap-2"},te={class:"line-clamp-1"},se=["onClick"],_e=D({__name:"AgentList",setup(t){const{apply:e,storage:u}=P("HD Ticket"),s=I(!1),p=[{label:"Name",key:"name",width:"w-80"},{label:"Email",key:"email",width:"w-80"},{label:"Username",key:"username",width:"w-80"}],o=L({doctype:"HD Agent",fields:["name","is_active","user.full_name","user.user_image","user.email","user.username"],auto:!0,transform:l=>{for(const c of l)c.onClick=()=>v(c.name);return l}});F(()=>({title:"Agents"}));function v(l){u.value.clear(),u.value.add({fieldname:"_assign",operator:"is",value:l}),e({name:B})}return(l,c)=>{const x=k,n=_("Button");return d(),h("div",X,[a(M,{title:"Agents"},{right:i(()=>[a(n,{label:"New agent",theme:"gray",variant:"solid",onClick:c[0]||(c[0]=m=>s.value=!s.value)},{prefix:i(()=>[a(x,{class:"h-4 w-4"})]),_:1})]),_:1}),a(g(H),{columns:p,resource:g(o),class:"mt-2.5",doctype:"HD Agent"},{name:i(({data:m})=>[r("div",Z,[r("div",ee,[a(g(R),{label:m.name,image:m.user_image,size:"sm"},null,8,["label","image"]),r("div",te,b(m.full_name),1)]),m.is_active?w("",!0):(d(),y(g(N),{key:0,size:"md",theme:"orange",variant:"subtle"},{default:i(()=>[f("Inactive")]),_:1}))])]),"row-extra":i(({data:m})=>[r("div",{class:"cursor-pointer text-xs",onClick:ne=>v(m.name)}," Tickets â†’ ",8,se)]),_:1},8,["resource"]),a(W,{show:s.value,onClose:c[1]||(c[1]=m=>s.value=!1)},null,8,["show"])])}}});export{_e as default};
